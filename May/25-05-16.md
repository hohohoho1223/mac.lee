# 오늘 내가 배운 것들(Today I Learned)

- 오늘은 챗봇 고도화에 대해 알아보았다.
- 챗봇 대화에서 이전 내용을 기반으로 답변을 진행하도록 설계하고자 한다.

---

- 아래는 해당 기능을 넣기 위한 방법 리스트이다.

| **방법**                     | **사용자 식별**                     | **히스토리 저장**          | **유지 기간**           | **난이도** | **설명**                  |
| -------------------------- | ------------------------------ | -------------------- | ------------------- | ------- | ----------------------- |
| 1️⃣ 세션 기반 (UUID + 메모리)     | UUID (프론트 생성)                  | Python dict          | 휘발성 (서버 리셋 시 삭제)    | ⭐ 매우 쉬움 | GPT 챗봇 MVP 구현에 가장 많이 쓰임 |
| 2️⃣ 세션 기반 (UUID + Redis)   | UUID                           | Redis 캐시             | TTL 기반 휘발성 (예: 10분) | ⭐⭐ 쉬움   | 동시 접속자 많을 때 추천          |
| 3️⃣ 로그인 기반 (memberId + DB) | memberId (백엔드 인증)              | MongoDB / PostgreSQL | 영구 저장               | ⭐⭐⭐ 중간  | 실서비스, 마이페이지 기능 구현 시 필수  |
| 4️⃣ 쿠키/세션 기반 식별            | 세션 쿠키 (Set-Cookie)             | 서버 메모리 or DB         | 브라우저에 따라 다름         | ⭐⭐⭐     | 웹사이트 기반 챗봇에 적합          |
| 5️⃣ JWT 기반 식별              | JWT 토큰 (Authorization: Bearer) | 서버 메모리 or DB         | 토큰 만료 기준            | ⭐⭐⭐     | 보안 및 인증 필요한 챗봇 서비스      |
| 6️⃣ WebSocket 기반           | 클라이언트 연결 ID                    | 서버에서 연결 유지           | 접속 중 유지             | ⭐⭐⭐⭐    | 실시간 챗봇이나 게임용            |
| 7️⃣ 브라우저 fingerprinting    | 브라우저 환경 기반 해시                  | 메모리/DB               | 휘발성 or 영구           | ⭐⭐      | 비회원 구분만 필요한 경우          |

---

## **사용 예시로 분류하면?**

### **1. 빠른 MVP / 인증 없는 챗봇**

- 방식: **UUID + 메모리(dict)**
- conversation_store[session_id] 에 히스토리 저장
- 프론트에서 UUID 생성 후 API에 함께 전달

---

### **2. 동시 접속자 고려 / 스케일 업 준비**

- 방식: **UUID + Redis**
- Redis를 메모리 기반 DB로 사용 (만료시간 설정)
- 적은 비용으로 큰 유저 처리 가능

---

### **3. 로그인 유저 + 마이페이지 저장 필요**

- 방식: **memberId + Mongo/PostgreSQL**
- 대화 저장 → 조회 → 재추천, 분석 등 가능
- 실서비스 수준에서 꼭 필요한 구조

---

### **4. 웹사이트 연동 챗봇**

- 방식: **세션 쿠키**
- FastAPI에서도 Set-Cookie / Depends로 식별 가능
- Django, Flask 등에서 많이 씀

---

### **5. 보안 인증 챗봇 (예: 기업용)**

- 방식: **JWT 토큰 기반 식별**
- 사용자 인증 → 토큰 발급 → 추론 시 토큰으로 인증
- Authorization 헤더 활용

##  결론

| **내가 만들 챗봇 상황**           | **추천 방식**                         |
| ------------------------- | --------------------------------- |
| 로그인 안 한 사용자도 구분하고 싶다      | UUID + session 방식 (프론트에서 생성해서 전달) |
| 로그인한 사용자라면 memberId 받으면 됨 | memberId 기반 저장                    |
| 성능, 사용자 수 많음 → 확장성 필요     | Redis 캐시 / MongoDB 구조 병행          |
| 보안까지 필요하다면                | JWT 인증 연동까지 구현                    |

## UUID가 뭔가?

- ## UUID (Universally Unique Identifier) = "전 세계에서 유일한 ID”
- ## 중복될 가능성이 거의 없는 **128비**트 난수 기반 문자열
- ## 예: a3f47d92-1b2c-478d-998e-9ab3ef119ac4

## UUID의 특징

- 고유성

1. 인증 없이 사용 가능
    - 로그인 안 한 사용자도 고유하게 식별 가능 
2. 브라우저에 저장 가능
    - 프론트에서 localStorage니 쿠키에 저장해 계속 유지
3. 클라이언트에서 생성 가능
    - 서버에 요청 안 해도 된다(JavaScript, Python 등으로 바로 생성 가능) 

---

- 그럼 대화내용은 어디에 저장할 수 있을까? 아래 표는 예시이다.

| **Python 메모리**           | conversation_store[sessionId] = [...] | 빠르고 구현 쉬움          | 서버 꺼지면 데이터 날아감 | 개발/테스트, 빠른 MVP    |
| ------------------------ | ------------------------------------- | ------------------ | -------------- | ----------------- |
| **Redis**                | 빠른 메모리 기반 저장소 (TTL 가능)                | 빠르고 유저 수 많아도 안정적   | 별도 설치 필요       | 동시 접속 많을 때, 데모/베타 |
| **MongoDB / PostgreSQL** | 구조화된 영구 저장                            | 영구 저장 가능, 분석/기록 용이 | 구현 복잡도 ↑       | 마이페이지/기록 보기/관리 등  |
| **로컬 파일 (.json, .pkl)**  | 서버 디렉토리에 저장                           | 간단한 저장 용도에 유용      | 동시성, 속도 매우 느림  | 1인용 챗봇, 실험용       |

- 지금 현재 테스트 및 V1(MVP) 출시 후 유지보수 기간(스프린트4)에는 "dict" 에 저장하고자 한다.

> Python dict (conversation_store)

- 예시:

```py
conversation_store = {}

# 저장 예시
conversation_store[sessionId] = [
    {"role": "user", "content": "환경에 좋은 챌린지 뭐 있어?"},
    {"role": "assistant", "content": "텀블러 사용, 걷기 등이 있어요."}
]
```

> 이렇게 저장하면 sessionId마다 대화 흐름을 기억할 수 있다.
> 사용자의 질문 (role: user)
> LLM의 응답 (role: assistant)

- 예전 질문 + 응답 + 이번 질문을 보고 -> LLM 답변을 받는다.

> store_conversation() 같은 함수로 처리하면 자동 저장 가능

- 즉, 비회원&회원 모두에게 제공해야하는 챗봇 서비르 이므로, UUID를 사용한다면 프론트에서 고유 sessionId를 내 서버에 호출해주면 된다.
- 이렇게 된다면 흡사 GPT처럼 대화 흐름 기억이 가능할 것으로 보인다.