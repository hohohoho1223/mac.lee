# ì˜¤ëŠ˜ ë‚´ê°€ ë°°ìš´ ê²ƒë“¤(Today I Learned)

- ì˜¤ëŠ˜ì€ íŒŒì´ë„í”„ë¡œì íŠ¸ ì—ì„œ "ë­ì²´ì¸ êµ¬ì¡°í™”"ë¥¼ ì§„í–‰í•˜ì˜€ë‹¤.
- ë˜í•œ ì•„í‚¤í…ì²˜ ìˆ˜ì •ë„ ì§„í–‰í•˜ì˜€ë‹¤.(ê·¸ëƒ¥ ì•ˆëë‚˜ëŠ”ì¤‘)

---

# LLMëª¨ë¸ì„ ìì²´ ì„œë¹™ ì½”ë“œ
- ì•„ë˜ ì½”ë“œëŠ” ì¼ë¶€ ë‚´ìš©ì„ ë°œì·Œí–ˆë‹¤

```py
# chatbot_app_vertex.py
%%writefile chatbot_app_vertex.py
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
from llm_model_vertex import get_llm_response
from langchain_rag_chain import qa_chain
import json

app = FastAPI()

class CategoryRequest(BaseModel):
    userId: int
    category: str
    location: str
    work_type: str

class FreeTextRequest(BaseModel):
    userId: int
    location: str
    work_type: str
    user_message: str

@app.post("/chatbot/select-category")
def select_category(req: CategoryRequest):
    prompt = f"""
    {req.location} í™˜ê²½ì— ìˆëŠ” {req.work_type} ì‚¬ìš©ìê°€ {req.category}ë¥¼ ì‹¤ì²œí•  ë•Œ,
    ì ˆëŒ€ì ìœ¼ë¡œ í™˜ê²½ì— ë„ì›€ì´ ë˜ëŠ” ì±Œë¦°ì§€ë¥¼ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œ 3ê°€ì§€ ì¶”ì²œí•´ì¤˜:
    ë°˜ë“œì‹œ ìˆœìˆ˜ JSONë§Œ ì¶œë ¥í•´ì¤˜.
    {{
        "status": 200,
        "message": "ì„±ê³µ!",
        "data": {{
            "recommand": "ì„¤ëª… í…ìŠ¤íŠ¸",
            "challenges": [
                {{"title": "ì±Œë¦°ì§€ ì´ë¦„", "description": "ì„¤ëª…"}}
            ]
        }}
    }}
    """
    return get_llm_response(prompt)

@app.post("/chatbot/freetext")
def free_text(req: FreeTextRequest):
    if not req.user_message.strip():
        raise HTTPException(status_code=400, detail="user_messageëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.")

    if not isinstance(req.user_message, str) or len(req.user_message.strip()) < 5:
        raise HTTPException(status_code=422, detail="user_messageëŠ” ë¬¸ìì—´ì´ì–´ì•¼ í•˜ë©°, ìµœì†Œí•œì˜ ì˜ë¯¸ë¥¼ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.")

    prompt = f"""
    ì‚¬ìš©ì ë©”ì‹œì§€: "{req.user_message}"
    ì§€ì—­: {req.location}, ì§ì—…: {req.work_type}
    í™˜ê²½ì— ë„ì›€ì´ ë˜ëŠ” ì±Œë¦°ì§€ë¥¼ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ 3ê°€ì§€ ì¶”ì²œí•´ì£¼ì„¸ìš”:
    {{
        "status": 200,
        "message": "ì„±ê³µ!",
        "data": {{
            "recommand": "ì„¤ëª… í…ìŠ¤íŠ¸",
            "challenges": [
                {{"title": "ì±Œë¦°ì§€ ì´ë¦„", "description": "ì„¤ëª…"}}
            ]
        }}
    }}
    """
    return get_llm_response(prompt)

@app.post("/chatbot/freetext-rag")
def freetext_rag(req: FreeTextRequest):
    if not req.user_message.strip():
        raise HTTPException(status_code=400, detail="user_messageëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.")
    if not isinstance(req.user_message, str) or len(req.user_message.strip()) < 5:
        raise HTTPException(status_code=422, detail="user_messageëŠ” ë¬¸ìì—´ì´ì–´ì•¼ í•˜ë©°, ìµœì†Œí•œì˜ ì˜ë¯¸ë¥¼ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.")

    # LangChain ì²´ì¸ì„ í†µí•œ ë©€í‹°ìŠ¤í… LLM í˜¸ì¶œ
    result = qa_chain.run(req.user_message)

    # ì‘ë‹µì—ì„œ JSON ì¶”ì¶œì´ ì•ˆ ë˜ë©´ ì˜ˆì™¸ ì²˜ë¦¬
    try:
        return json.loads(result)
    except Exception:
        return {
            "status": 500,
            "message": "âŒ LangChain ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨",
            "data": None
        }
```

```py
%%writefile langchain_rag_chain.py
from langchain.prompts import PromptTemplate
from langchain.chains import RetrievalQA
from langchain.vectorstores import Chroma
from langchain.embeddings import SentenceTransformerEmbeddings
from langchain.llms.base import LLM
from vertexai.generative_models import GenerativeModel
from google.oauth2 import service_account

# Gemini LLM ë˜í¼ í´ë˜ìŠ¤
def init_gemini_llm(credentials_path, project, location, model_name):
    class GeminiLLM(LLM):
        def __init__(self):
            credentials = service_account.Credentials.from_service_account_file(credentials_path)
            vertexai.init(project=project, location=location, credentials=credentials)
            self.model = GenerativeModel(model_name)

        def _call(self, prompt, stop=None):
            response = self.model.generate_content(prompt)
            return getattr(response, "text", "")

        @property
        def _llm_type(self):
            return "gemini-vertex"

    return GeminiLLM()

# í™˜ê²½ ì„¤ì •
CREDENTIALS_PATH = "/content/kakao-project-457106-b926aa186fc4.json"
PROJECT = "kakao-project-457106"
LOCATION = "us-central1"
MODEL_NAME = "gemini-1.5-flash"

llm = init_gemini_llm(CREDENTIALS_PATH, PROJECT, LOCATION, MODEL_NAME)

# ë²¡í„° DB ì„¤ì • (Chroma ê¸°ë°˜)
embedding_fn = SentenceTransformerEmbeddings(model_name="all-MiniLM-L6-v2")
vectorstore = Chroma(persist_directory="./chroma_db", embedding_function=embedding_fn)
retriever = vectorstore.as_retriever()

# í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
prompt = PromptTemplate(
    input_variables=["context", "question"],
    template="""
ë‹¤ìŒ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ì‚¬ìš©ì ìš”ì²­ì— ë§ëŠ” ì¹œí™˜ê²½ ì±Œë¦°ì§€ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ 3ê°œ ì¶”ì²œí•´ì£¼ì„¸ìš”.

ë¬¸ì„œ:
{context}

ìš”ì²­:
{question}

ì•„ë˜ í¬ë§·ì„ ê·¸ëŒ€ë¡œ ì§€ì¼œì„œ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”:
{
  "status": 200,
  "message": "ì„±ê³µ!",
  "data": {
    "recommand": "...",
    "challenges": [
      {"title": "...", "description": "..."},
      {"title": "...", "description": "..."},
      {"title": "...", "description": "..."}
    ]
  }
}
"""
)

# LangChain ì²´ì¸ ì •ì˜
qa_chain = RetrievalQA.from_chain_type(
    llm=llm,
    retriever=retriever,
    chain_type_kwargs={"prompt": prompt}
)

# ì™¸ë¶€ì—ì„œ importí•  ìˆ˜ ìˆê²Œ export
__all__ = ["qa_chain"]
```

- ì—¬ê¸°ì„œ ì˜ë¬¸ì ì´ ë“¤ì—ˆë‹¤

## ì´ë¯¸ chatbot_app_vertex.pyì—ì„œ í”„ë¡¬í”„íŠ¸ê°€ ì„¤ê³„ë˜ì–´ìˆëŠ”ë°, LanChain ì“¸ ë•Œ ì™œ langchain_rag_chain.pyì— ë˜ PromptTemplateì´ í•„ìš”í•˜ì§€?
> ë‚˜ëŠ” í•˜ë‚˜ì˜ í”„ë¡¬í”„íŠ¸ ë­ì²´ì¸ì„ ì„¤ê³„í•˜ëŠ”ê±¸ë¡œ ì•Œê³  ìˆì—ˆë‹¤.

| **êµ¬ë¶„**                                    | **ëª©ì **                                      | **í”„ë¡¬í”„íŠ¸ ìœ„ì¹˜**                |
| ----------------------------------------- | ------------------------------------------- | -------------------------- |
| **ê¸°ì¡´ êµ¬ì¡° (llm_model_vertex.py)**           | FastAPIì—ì„œ ë°”ë¡œ Gemini í˜¸ì¶œí•˜ëŠ” **ë‹¨ì¼ ìŠ¤í… ì²˜ë¦¬**       | get_llm_response() ì•ˆì— í•˜ë“œì½”ë”© |
| **LangChain êµ¬ì¡° (langchain_rag_chain.py)** | ê²€ìƒ‰ â†’ ë¬¸ì„œ ì¡°ë¦½ â†’ í”„ë¡¬í”„íŠ¸ë¡œ **LLMì— ì „ë‹¬í•˜ëŠ” ë©€í‹°ìŠ¤í… ì²´ì¸ êµ¬ì„±** | PromptTemplateìœ¼ë¡œ í…œí”Œë¦¿í™”      |

- ì™œ LangChainì—ì„œ `PromptTemplete`ì„ ë”°ë¡œ ì“°ëŠ”ê°€?
    - LangChainì—ì„œì˜ í”„ë¡¬í”„íŠ¸ë„ **í•˜ë‚˜ì˜ ëª¨ë“ˆì²˜ëŸ¼ ì¬ì‚¬ìš©ì´ ê°€ëŠ¥í•œ êµ¬ì„±ìš”ì†Œë¡œ ì·¨ê¸‰í•¨
    - ê·¸ë˜ì„œ "ë¬¸ì„œ + ì§ˆë¬¸ -> í”„ë¡¬í”„íŠ¸ë¡œ ì¡°ë¦½" ì´ë¼ëŠ” ë©€í‹°ìŠ¤í… ì¤‘ê°„ ë‹¨ê³„ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•œ ê²ƒ
- ê²°ë¡ : í”„ë¡¬í”„íŠ¸ê°€ ì¤‘ë³µë˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ëª©ì ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ë¶„ë¦¬í•œ ê²ƒì´ë‹¤!
- ë‚´ê°€ ì´í•´í•œ ë°”ë¡œëŠ” ìš°ì„  `def free_text()` ì—ì„œ LLMí˜¸ì¶œë¡œ ë‹µë³€ì„ ë°›ê³ , í•´ë‹¹ ë‹µë³€ê³¼ ì°¸ê³  ë¬¸ì„œ(RAGê¸°ë²•)ë¥¼ ì²´ì¸ì²˜ëŸ¼ ì—®ì€ë‹¤ìŒ ìµœì¢…ìœ¼ë¡œ LLM(PromptTemplate)ì—ë‹¤ê°€ í˜¸ì¶œí•˜ì—¬ ë‹µë³€ì„ ë°›ëŠ”ê²ƒ ì´ë¼ê³  ì´í•´í–ˆë‹¤.

- ì „ì²´íë¦„
    ```mermaid
    graph LR
    A[ì‚¬ìš©ì ììœ  ì…ë ¥] --> B[LangChain: question ë“±ë¡]
    B --> C[Retriever â†’ ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰ (context)]
    C --> D[PromptTemplateì— context + question ì‚½ì…]
    D --> E[ì¡°ë¦½ëœ í”„ë¡¬í”„íŠ¸ â†’ LLM í˜¸ì¶œ (get_llm_response ë‚´ë¶€)]
    E --> F[LLM ì‘ë‹µ(JSON ì±Œë¦°ì§€)]
    ```
    - ë‚˜ëŠ” ì—¬ê¸°ì„œ ë²¡í„° DBëŠ” ë‹¨ìˆœ .txt ë„£ëŠ” ì €ì¥ì†Œë¼ê³  ìƒê°ì´ ë“¤ì–´ì„œ ì™œ ë²¡í„°DBê°€ ì°¨ì´ê°€ ë‚˜ëŠ”ê±°ì§€? ë¼ëŠ” ì˜êµ¬ì‹¬ì´ ë“¤ì—ˆë‹¤. 
    > GPTë‹´ë³€: ë²¡í„° DBëŠ” ë‹¨ìˆœ ì €ì¥ì†Œê°€ ì•„ë‹ˆë¼ â€œë¬¸ì¥ì„ ìˆ˜ì¹˜í™”(ì„ë² ë”©)í•´ì„œ ìœ ì‚¬ë„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” íŠ¹ìˆ˜í•œ ë°ì´í„°ë² ì´ìŠ¤â€ì…ë‹ˆë‹¤.
    - ê·¸ë ‡ë‹¤ê³  í•œë‹¤
    - ê·¸ëŸ¼ ì¼ë°˜ DBì™€ ë²¡ì²˜ DBì˜ ì°¨ì´ëŠ” ë­˜ê¹Œ?
    | **í•­ëª©** | **ì¼ë°˜ RDB (ì˜ˆ: PostgreSQL)**  | **ë²¡í„° DB (ì˜ˆ: Qdrant, Pinecone)** |
| ------ | --------------------------- | ------------------------------- |
| ì €ì¥ ëŒ€ìƒ  | ë¬¸ìì—´, ìˆ«ì ë“± ëª…ì‹œì  ìŠ¤í‚¤ë§ˆ ë°ì´í„°       | í…ìŠ¤íŠ¸ â†’ ì„ë² ë”© ë²¡í„° (ê³ ì°¨ì› float ë¦¬ìŠ¤íŠ¸)    |
| ì¡°íšŒ ë°©ì‹  | WHERE ì ˆë¡œ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë°ì´í„° ê²€ìƒ‰    | ìœ ì‚¬í•œ ì˜ë¯¸ë¥¼ ê°€ì§„ ë¬¸ì¥ì„ ì°¾ì•„ëƒ„ (ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ë“±)  |
| í™œìš© ëª©ì   | íŠ¸ëœì­ì…˜, í•„í„°ë§ ì¤‘ì‹¬ (ì˜ˆ: ìœ ì €, ì£¼ë¬¸ ì •ë³´) | ìì—°ì–´ ê¸°ë°˜ ìœ ì‚¬ ì§ˆì˜ ëŒ€ì‘ (ì˜ˆ: ì±—ë´‡, ê²€ìƒ‰)     |
| ë°ì´í„° êµ¬ì¡° | í…Œì´ë¸”(í–‰/ì—´)                    | ë²¡í„° + ë©”íƒ€ë°ì´í„° êµ¬ì¡°                   |
| ì¸ë±ì‹± ë°©ì‹ | B-Tree, Hash                | HNSW, IVF, PQ ë“± ê³ ì† ë²¡í„° ì¸ë±ì‹±       |
- ë²¡í„°í™”ë¡œ ì„ë² ë”œì„ í•´ì„œ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ í†µí•´ ì˜ë¯¸ë¥¼ ê°€ì§„ ìë£Œë¥¼ ì°¾ëŠ”ê²ƒ!
    - .txt íŒŒì¼ì€ ë²¡í„° DBì— ë“¤ì–´ê°€ê¸° ìœ„í•œ "ì†ŒìŠ¤" ì¼ë¿
    - ì‹¤ì œ ë²¡í„°DBëŠ” í…ìŠ¤íŠ¸ -> ë²¡í„° ë³€í™˜ + ê³ ì† ìœ ì‚¬ë„ ê²€ìƒ‰ê¹Œì§€ í¬í•¨ëœ ê¸°ëŠ¥ì„ ì œê³µ
    - ì•”íŠ¼ .txtíŒŒì¼ì˜ ìì—°ì–´ë¥¼ ë²¡í„°í™”í•´ì„œ ë²¡í„° DBì— ë„£ëŠ”ê±°ì„ .txtíŒŒì¼ì´ DBê°€ ì•„ë‹ˆë¼

## ê·¸ëŸ¼ ë²¡í„°DBê°€ ë‹¤ì–‘í•œ ì´ìœ ëŠ” ë­”ë°?

1. **ë²¡í„° ê²€ìƒ‰ ì„±ëŠ¥ í–¥ìƒ ê¸°ë²•ì´ ë‹¤ë¦„**

- ê° DBë§ˆë‹¤ **â€œë²¡í„°ë¥¼ ì–´ë–»ê²Œ ì¸ë±ì‹±í•  ê²ƒì¸ê°€â€**ì— ëŒ€í•œ ì „ëµì´ ë‹¤ë¥´ë‹¤
- ë²¡í„°ëŠ” ìˆ˜ì²œ-ìˆ˜ë§Œ ì°¨ì›ì˜ **ì‹¤ìˆ˜ ë°°ì—´ ì´ê¸°ë–„ë¬¸ì— ì¼ë°˜ SQLì²˜ëŸ¼ WHEREì ˆë¡œ ëª»ì°¾ìŒ**

| **DB**       | **ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜ ì˜ˆì‹œ**                | **íŠ¹ì§•**                  |
| ------------ | ----------------------------- | ----------------------- |
| **FAISS**    | IVF, HNSW, PQ                 | Facebookì´ ê°œë°œ, ë¡œì»¬ì—ì„œ ë¹ ë¦„   |
| **Qdrant**   | HNSW + SIMD ìµœì í™”               | CPU ê¸°ë°˜ ë¹ ë¥¸ ê²€ìƒ‰, í•„í„°ë§ ê¸°ëŠ¥ ìš°ìˆ˜ |
| **Pinecone** | ê³ ìœ  ë²¡í„° ì—”ì§„ (ìœ ì‚¬ HNSW)            | í´ë¼ìš°ë“œ ì „ìš©, ê´€ë¦¬í˜•, ë©€í‹°í…Œë„Œì‹œ     |
| **Weaviate** | HNSW + Graph + Object Storage | ë©”íƒ€ë°ì´í„°/ê°ì²´ê²€ìƒ‰ ê°•í•¨           |
| **Milvus**   | IVF_FLAT, HNSW, GPU ì§€ì›        | ëŒ€ìš©ëŸ‰, ë³‘ë ¬ì„± ì¢‹ìŒ             |
| **Chroma**   | sqlite ê¸°ë°˜ ë‚´ë¶€êµ¬ì¡°                | ê°„í¸í•˜ì§€ë§Œ ê³ ì„±ëŠ¥ì€ ì•„ë‹˜ (ì‹¤í—˜ìš©)     |

2. **ë©”íƒ€ë°ì´í„° í•„í„°ë§ ì§€ì› ì—¬ë¶€**

> ë‹¨ìˆœ ìœ ì‚¬ë„ë§Œ ë³´ëŠ”ê²Œ ì•„ë‹ˆë¼ location = â€œë„ì‹œâ€ AND category = â€œì œë¡œì›¨ì´ìŠ¤íŠ¸â€ ê°™ì´ í•„í„°ë„ ê±¸ê³  ì‹¶ì„ ë–„ 

| **ë²¡í„° DB** | **ë©”íƒ€ë°ì´í„° í•„í„°ë§** | **ì„¤ëª…**              |
| --------- | ------------- | ------------------- |
| Qdrant    | ì§€ì›            | ì •êµí•œ í•„í„° + AND/OR/NOT |
| FAISS     | ë¯¸ì§€ì›           | ì˜¤ë¡œì§€ ë²¡í„° ìœ ì‚¬ë„ë§Œ         |
| Pinecone  | ì§€ì›            | ê´€ë¦¬í˜•ì—ì„œ í•„í„° ê°€ëŠ¥         |
| Chroma    | ì œí•œì            | JSON ê¸°ë°˜ but ì„±ëŠ¥ì€ ë‚®ìŒ  |

3. **ë°°í¬/í™•ì¥ì„± ì°¨ì´**

> ë¡œì»¬ -> í´ë¼ìš°ë“œ -> API ì—°ë™ ë°©ì‹ê¹Œì§€ ë‹¤ì–‘

| **í•­ëª©**    | **FAISS**    | **Qdrant** | **Pinecone** | **Chroma** |
| --------- | ------------ | ---------- | ------------ | ---------- |
| ë¡œì»¬ ì‹¤í–‰     | âœ…            | âœ… (Docker) | âŒ            | âœ…          |
| í´ë¼ìš°ë“œ API  | âŒ            | âœ…          | âœ… (ê´€ë¦¬í˜• SaaS) | âŒ          |
| ìˆ˜ì‹­ë§Œ~ë°±ë§Œ ë²¡í„° | âš ï¸ (RAM ë§ì•„ì•¼) | âœ…          | âœ…            | âŒ          |
| ì‹¤ì‹œê°„ ì„œë¹„ìŠ¤   | âŒ            | âœ…          | âœ…            | âŒ          |

## ê²°ë¡  :

- **ë²¡í„° DBëŠ” â€œì†ë„â€, â€œí•„í„°ë§â€, â€œí™•ì¥ì„±â€, â€œë°°í¬ ë°©ì‹â€ ì´ 4ê°€ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê¸°ìˆ ì´ ë‹¬ë¼ì§„ë‹¤.**
- ë‹¨ìˆœíˆ ë²¡í„° ì €ì¥ì´ ì•„ë‹ˆë¼, ë²¡í„° ê²€ìƒ‰ì„ **ë¹ ë¥´ê³  ì •í™•í•˜ê³  ì•ˆì „í•˜ê²Œ í•  ìˆ˜ ìˆë„ë¡** ê°ì ë°©ì‹ì´ ë‹¤ë¦„

---

- ê·¸ëŸ¼ í•´ë‹¹ í”„ë¡œì íŠ¸(Leafresh)ëŠ” JSON í˜•íƒœë¡œ ì „ë‹¬í•˜ë¯€ë¡œ Chromaë‘ ì–´ìš¸ë¦¬ì§€ ì•Šì„ê¹Œ?
    - Chromaê°€ JSONí˜•íƒœë¡œ ì €ì¥í•  ìˆ˜ ìˆëŠ”ê±´ ë§ì§€ë§Œ
    - API ì—°ë™ìš© ì‹¤ì„œë¹„ìŠ¤ì— ì“°ê¸°ì—” ë¦¬ìŠ¤í¬ê°€ ì¡´ì¬í•œë‹¤.
    ```json
    vectorstore.add_texts(
    texts=["í…€ë¸”ëŸ¬ ì‚¬ìš© ì±Œë¦°ì§€"],
    metadatas=[{"category": "ì œë¡œì›¨ì´ìŠ¤íŠ¸", "location": "ë„ì‹œ"}]
    )
    ```
    -  ëª°ë¡  ë‚´ë¶€ì ìœ¼ë¡  â€œë²¡í„° + JSON ë©”íƒ€ë°ì´í„°" êµ¬ì¡°ê°€ ë§ìŒ
    - í•˜ì§€ë§Œ ì´ê±¸ â€œAPI ê¸°ë°˜ìœ¼ë¡œ ì•ˆì •ì ìœ¼ë¡œ ì„œë¹™í•œë‹¤?â€ëŠ” ë‹¤ë¥¸ ë¬¸ì œì„

- ë¹„êµ
| **í•­ëª©**                        | **Qdrant**           | **FAISS**    | **Pinecone**   | **Weaviate** | **Chroma** |
| ----------------------------- | -------------------- | ------------ | -------------- | ------------ | ---------- |
| **ê²€ìƒ‰ ì†ë„** <br/>(1M ë²¡í„°, Top-5) | **~15ms**            | ~20ms        | ~30ms          | ~22ms        | ~25ms      |
| **í™•ì¥ì„±** <br/>(ìˆ˜ì‹­ë§Œ ë²¡í„° ì´ìƒ)      | âœ… ë§¤ìš° ì¢‹ìŒ              | âŒ RAM í•œê³„     | âœ… SaaS ê¸°ë°˜ ë¬´ì œí•œ  | âœ… ë¶„ì‚° ê°€ëŠ¥      | âŒ ì‹¤í—˜ ìˆ˜ì¤€    |
| **ë””ìŠ¤í¬ ì €ì¥ (Persistence)**      | âœ… O (disk ê¸°ë°˜)        | âŒ X (RAM ê¸°ë°˜) | âœ… O            | âœ… O          | âŒ ë¹„ì •í˜• JSON |
| **ë©”íƒ€ë°ì´í„° í•„í„°ë§**                 | âœ… ë§¤ìš° ê°•ë ¥              | âŒ ì—†ìŒ         | âœ… O            | âœ… O          | âŒ ì—†ìŒ       |
| **ë©€í‹° í…Œë„Œì‹œ (collection ë¶„ë¦¬)**    | âœ… O (collection ì§€ì›)  | âŒ ë¶ˆê°€         | âœ… O            | âœ… O          | âœ… ì œí•œì       |
| **LangChain í†µí•© ë‚œì´ë„**          | âœ… ì‰¬ì›€                 | âœ… ì‰¬ì›€         | âœ… ì‰¬ì›€           | âš  ì•½ê°„ ë³µì¡      | âœ… ì‰¬ì›€       |
| **ìš´ì˜ ë‚œì´ë„**                    | âš  GCE ì§ì ‘ ë°°í¬ í•„ìš”       | âœ… ë¡œì»¬ë§Œ ì‚¬ìš©     | âœ… SaaS, ì„¤ì¹˜ ë¶ˆí•„ìš” | âš  ì„¤ì • ë§ìŒ      | âœ… í…ŒìŠ¤íŠ¸ìš© ì í•©  |
| **í•œêµ­ì–´ ë²¡í„° í˜¸í™˜ì„±**                | âœ… ì ì ˆ (ì„ë² ë”© ëª¨ë¸ì— ë”°ë¼ ë‹¤ë¦„) | âœ…            | âœ…              | âœ…            | âœ…          |
| **Open Source ì—¬ë¶€**            | âœ… ì™„ì „ ê³µê°œ              | âœ… ì™„ì „ ê³µê°œ      | âŒ ìœ ë£Œ           | âœ… ê³µê°œ         | âœ… ê³µê°œ       |
| **ë¹„ìš©**                        | âœ… ë¬´ë£Œ (ìì²´ í˜¸ìŠ¤íŒ…)        | âœ… ë¬´ë£Œ         | âŒ ìœ ë£Œ           | âœ… ë¬´ë£Œ (ìì²´)    | âœ… ë¬´ë£Œ       |

- ê·¼ë° ChromaDBê°€ "ì‹¤ì‹œê°„ ì„œë¹„ìŠ¤ê°€ ì–´ë µë‹¤"ëŠ”ê²Œ ë¬´ìŠ¨ëœ»ì´ì§€?
    >  ChromaëŠ” ë¡œì»¬íŒŒì¼ ê¸°ë°˜ì´ê¸° ë–„ë¬¸ì—, ê±°ë¹„ìŠ¤ ë°°í¬ì™€ ì‹¤ì‹œê°„ ìš”ì²­ ì²˜ë¦¬ë¥¼ ê°ë‹¹í•˜ê¸° ì–´ë ¤ì›€
    1. ğŸ”’ ë™ì‹œì„±(concurrency) ì œí•œ
	    - ChromaëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Python í”„ë¡œì„¸ìŠ¤ ì•ˆì—ì„œ ë™ì‘í•˜ëŠ” in-process vector storeì…ë‹ˆë‹¤.
	    - ì—¬ëŸ¬ FastAPI ìš”ì²­ì´ ë™ì‹œì— chroma_dbì— ì ‘ê·¼í•  ê²½ìš° â†’ íŒŒì¼ ì ê¸ˆ(lock), I/O ì¶©ëŒ ë°œìƒ ê°€ëŠ¥
	    - íŠ¹íˆ ì½”ë©/ì„œë²„ì—ì„œ ë™ì‹œì— add_texts() ë˜ëŠ” similarity_search() í˜¸ì¶œí•˜ë©´ ì˜¤ë¥˜ ë°œìƒ í™•ë¥ ì´ í¼

    2. ì‹¤ì‹œê°„ ì¸ë±ì‹± ë°˜ì˜ ì†ë„ ëŠë¦¼
	    - add_documents()ë¡œ ë²¡í„°ë¥¼ ë„£ë”ë¼ë„, ê²€ìƒ‰ì— ë°˜ì˜ë˜ê¸°ê¹Œì§€ delayê°€ ë°œìƒí•˜ê±°ë‚˜
	    - ìì²´ì ì¸ ì¸ë±ìŠ¤ ì¬êµ¬ì„±(rebuild) ë¡œ ì¸í•´ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ
	    - Pinecone, Qdrantì²˜ëŸ¼ ì‚½ì… ì¦‰ì‹œ ê²€ìƒ‰ì— ë°˜ì˜ë˜ëŠ” êµ¬ì¡°ê°€ ì•„ë‹˜

    3. ë…ë¦½ ì‹¤í–‰ ì„œë²„(REST API ì„œë²„)ë¡œ ë™ì‘í•˜ì§€ ì•ŠìŒ
	    - ChromaëŠ” from_documents()ë¡œ ì§ì ‘ ì ‘ê·¼í•´ì•¼ë§Œ í•¨
	    - localhost:6333 ê°™ì€ REST APIë¥¼ ì—´ ìˆ˜ ì—†ìŒ â†’ ì„œë²„ ë¶„ë¦¬í˜• êµ¬ì¡° ë¶ˆê°€
	    - ë”°ë¼ì„œ ë²¡í„° DBì™€ FastAPIë¥¼ ë”°ë¡œ ë„ì›Œ **ë¶„ì‚° ì„œë¹„ìŠ¤**í•˜ê¸° ì–´ë ¤ì›€

> ë¹„ìœ ë¡œ ì´í•´í•˜ë©´ 
> 1. ì¹´í˜ì—ì„œ ì†ë‹˜ 10ëª…ì´ ë™ì‹œì— ì»¤í”¼ì£¼ë¬¸ í•˜ëŠ”ë°, ë‚´ê°€ í˜¼ìì„œ ë‹¤ ë§Œë“¤ì–´ì•¼í•˜ëŠ” ìƒí™©
> 2. ì†ë‹˜ì´ ë©”ë‰´íŒ ìˆ˜ì •ì´ í•„ìš”í•˜ë‹¤ í•˜ì§€ë§Œ ë°”ìœ ë‚˜ëŠ” ì¼ì¼íˆ ê³ ì¹˜ê¸°ì—ëŠ” ì‹œê°„ì´ ì†Œìš”
> 3. ì¹´í˜ ì„œë²„ë¥¼ ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•˜ê³  ì‹¶ì§€ë§Œ ë‚´ê°€ ì „í™”ë„ ì•ˆë°›ê³  ë¬µë¬µì‘ë‹µ

- ì„œë²„ ë¶„ì‚°ì„ ì™œ í•„ìš”ë¡œ í•˜ëŠ”ê±¸ê¹Œ?
| ëª©ì  | ì´ìœ  / íš¨ê³¼ |
|------------------------|------------------------------------------------------------------------------|
|   ë™ì‹œ ìš”ì²­ ì²˜ë¦¬         | ì—¬ëŸ¬ ìš”ì²­ì„ ë‚˜ëˆ  ì²˜ë¦¬í•˜ë©´ ì†ë„ì™€ ì•ˆì •ì„± í–¥ìƒ<br>ì˜ˆ: FastAPIëŠ” API ì „ë‹´, QdrantëŠ” ê²€ìƒ‰ë§Œ ë‹´ë‹¹ |
|   ì—­í•  ë¶„ë¦¬             | ê° ì„œë²„ê°€ ëª…í™•í•œ ì±…ì„ì„ ê°€ì§<br>â†’ ìœ ì§€ë³´ìˆ˜ ìš©ì´, LLMë§Œ ì¬ë°°í¬ ê°€ëŠ¥                              |
|   í™•ì¥ì„± (Scalability)  | íŠ¸ë˜í”½ ì¦ê°€ ì‹œ í•´ë‹¹ ì„œë²„ë§Œ ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥<br>ì˜ˆ: ë²¡í„° ìˆ˜ ì¦ê°€ ì‹œ Qdrantë§Œ ê³ ì‚¬ì–‘ìœ¼ë¡œ ì´ê´€         |
|   ë…ë¦½ ë°°í¬ (Isolation) | ë¬¸ì œ ë°œìƒ ì‹œ ê°œë³„ ì„œë²„ë§Œ ë¦¬ë¶€íŒ…/ìˆ˜ì • ê°€ëŠ¥<br>â†’ ì „ì²´ ì„œë¹„ìŠ¤ ì˜í–¥ ìµœì†Œí™”                        |
|   ë³´ì•ˆ ì •ì±… ë¶„ë¦¬         | ì„œë²„ë³„ IP ì œí•œ, ì¸ì¦, CORS ë‹¤ë¥´ê²Œ ì„¤ì • ê°€ëŠ¥<br>â†’ ë‚´ë¶€ë§ Qdrant + ì™¸ë¶€ ì˜¤í”ˆ API êµ¬ì„± ê°€ëŠ¥        |
|   ì‹¤ì‹œê°„ ê°±ì‹            | ë²¡í„° DBì— ë¬¸ì„œ ì¶”ê°€í•´ë„ API ì„œë²„ ì¬ì‹œì‘ ë¶ˆí•„ìš”<br>â†’ ì‹¤ì‹œê°„ ë¬¸ì„œ ì—…ë°ì´íŠ¸ ë°˜ì˜ ê°€ëŠ¥               |
- ìœ ì €ìˆ˜ì— ë”°ë¥¸ ì„œë²„ ê³¼ë¶€í™”(íŠ¸ë ˆí”½ì¦ê°€)ì²˜ë¦¬ ë° ë³´ì•ˆ ì •ì±… ê·¸ë¦¬ê³  ì‹¤ì‹œê°„ ê°±ì‹ ì´ í° ì´ìœ  ê°™ë‹¤.
> CORS(Cross-Origin Resource Sharing) : ì„œë¡œë‹¤ë¥¸ ì¶œì²˜(origin)ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ìš”ì²­ì„ í—ˆìš©í•  ê²ƒì¸ì§€ ê²°ì •í•˜ëŠ” ë³´ì•ˆ ì •ì±…
- í¬íŠ¸ê°€ ë‹¤ë¥´ë©´ ì™œ ë‹¤ë¥¸ ì¶œì²˜ì¼ê¹Œ?
    > ì¶œì²˜(origin)ëŠ” 3ê°€ì§€ë¡œ êµ¬ì„±ëœë‹¤:
    > ì¶œì²˜ = í”„ë¡œí† ì½œ + í˜¸ìŠ¤íŠ¸ + í¬íŠ¸
    | êµ¬ì„± ìš”ì†Œ    | ì˜ˆì‹œ                | ì„¤ëª…                                |
|-------------|---------------------|-------------------------------------|
| **í”„ë¡œí† ì½œ** | `http`, `https`     | í†µì‹  ë°©ì‹ (ë³´ì•ˆ ì—¬ë¶€ í¬í•¨)              |
| **í˜¸ìŠ¤íŠ¸**   | `localhost`, `example.com` | ì„œë²„ ì£¼ì†Œ (ë„ë©”ì¸ ë˜ëŠ” IP)              |
| **í¬íŠ¸**     | `3000`, `8000`      | ì„œë¹„ìŠ¤ê°€ ì—´ë ¤ ìˆëŠ” í¬íŠ¸ ë²ˆí˜¸             |







| **ë¬¸ì œì **          | **ì„¤ëª…**                                                                     |
| ---------------- | -------------------------------------------------------------------------- |
| **íŒŒì¼ ê¸°ë°˜ ì €ì¥ì†Œ**    | persist_directory='./chroma_db'ë¡œ ì €ì¥ë¨. íŒŒì¼ì— ì§ì ‘ ì ‘ê·¼í•´ì•¼ í•˜ë¯€ë¡œ **API ì„œë²„ë¥¼ ë¶„ë¦¬í•˜ê¸° ì–´ë µë‹¤** |
| **ì¸ë±ì‹± ëŠë¦¼/ì—†ìŒ**    | ë°ì´í„°ë¥¼ ì¶”ê°€í•´ë„ ë‚´ë¶€ ì¸ë±ìŠ¤ ìë™ ê°±ì‹ ì´ ëŠë¦¬ê³  ë¶ˆì•ˆì •í•  ìˆ˜ ìˆìŒ. ì‹¤ì‹œê°„ìœ¼ë¡œ â€œì¶”ê°€â†’ê²€ìƒ‰â€ì´ ë¹ ë¥´ê²Œ ì´ì–´ì§€ê¸° í˜ë“¦          |
| **ë™ì‹œì„± ë¶€ì¡±**       | FastAPIì—ì„œ ìš”ì²­ì´ ë§ì•„ì§€ë©´ ì—¬ëŸ¬ ì“°ë ˆë“œê°€ ë™ì‹œì— chroma_db íŒŒì¼ì„ ê±´ë“œë¦´ ìˆ˜ ìˆì–´ ì¶©ëŒ ìœ„í—˜                |
| **ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™” ìœ„í—˜** | ì½”ë©/ë¡œì»¬ í™˜ê²½ì€ ì¬ì‹œì‘ ì‹œ ë°ì´í„° íœ˜ë°œ ê°€ëŠ¥ì„± ìˆìŒ                                              |
| **ì„œë²„ ë¶„ë¦¬ ë¶ˆê°€**     | ë²¡í„° ì„œë²„ë¥¼ API ì„œë²„ì™€ **ì™„ì „íˆ ë¶„ë¦¬ëœ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë„ìš¸ ìˆ˜ ì—†ìŒ**                                   |

- êµ¬ì¡°ìš”ì•½
```mermaid
graph TD
  A[ì‚¬ìš©ì ì…ë ¥] --> B[qa_chain.run()]
  B --> C[Qdrant ë²¡í„° ê²€ìƒ‰ (context)]
  C --> D[PromptTemplate ì¡°ë¦½]
  D --> E[Mistral ëª¨ë¸ í˜¸ì¶œ]
  E --> F[JSON ì‘ë‹µ ì¶œë ¥]
```






---
# í”„ë¡œì íŠ¸ ì•„í‚¤í…ì²˜ ìˆ˜ì •

- API URIê°€ ëŒ€ëŒ€ì ìœ¼ë¡œ ê°œí¸ëë‹¤.
    - LLM ChatBot
        - /ai/chatbot/select-category â†’ /ai/chatbot/recommendation/message
        - /ai/chatbot/freetext â†’ /ai/chatbot/recommendation/form
    - LLM Censor
        - /ai/validate-challenge â†’  /ai/challenges/group/validation
    - LLM Verify
        - /ai/verify-image â†’ /ai/verifications/image
        - /ai/verify-result â†’ /callback/ai/verifications/result